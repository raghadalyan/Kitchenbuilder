@page "/"
@inject Kitchenbuilder.Core.SolidWorksSessionService SwSession
@using SolidWorks.Interop.sldworks
@using Kitchenbuilder.Core

<h3>Welcome to the Kitchen Builder</h3>

@if (!string.IsNullOrEmpty(status))
{
    <p>@status</p>
}

@code {
    string status = "Initializing...";

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // 1. Connect to SolidWorks
            var swType = Type.GetTypeFromProgID("SldWorks.Application");
            var swApp = (ISldWorks)Activator.CreateInstance(swType)!;
            swApp.Visible = true;

            SwSession.SetApp(swApp);

            // 2. Open the Wall2 part
            string path = @"C:\Users\chouse\Downloads\Kitchenbuilder\KitchenParts\Walls\Wall2.SLDPRT";
            int errs = 0, warns = 0;

            var model = (IModelDoc2)swApp.OpenDoc6(path, 1, 1, "", ref errs, ref warns)!;

            if (model != null)
            {
                status = "✅ SolidWorks connected and part opened!";

                EditPlaneOffset.UpdatePlaneOffset(swApp, "Plane_Microwave", 1.2); // 90 cm
            }
            else
            {
                status = "❌ Failed to open the part.";
            }
        }
        catch (Exception ex)
        {
            status = $"❌ Error: {ex.Message}";
        }
    }
}
